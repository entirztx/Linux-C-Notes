# 进程间通信

## 管道

> 内核提供，单工，自同步机制

匿名管道

`pipe()`

```c
//  create pipe
#include <unistd.h>

int pipe(int pipefd[2]);   // pipefd[0]作为读端，pipefd[1]作为写端
```

命名管道

`mkfifo`

```c
//  make a FIFO special file (a named pipe)
#include <sys/types.h>
#include <sys/stat.h>

int mkfifo(const char *pathname, mode_t mode);
```

## XSI  ->  SysV

IPC ->  Inter-Process Communication

主动端：先发包的一方

被动端：先收包的一方（先运行）

key:`ftok()`

```c
//  ftok  - convert a pathname and a project identifier to a System V IPC key
#include <sys/types.h>
#include <sys/ipc.h>

key_t ftok(const char *pathname, int proj_id);
```

**Message Queues(消息队列)(双工)**

`msgget()`

`msgop()`

`msgctl()`

```c
#include <sys/types.h>
#include <sys/ipc.h>
#include <sys/msg.h>

//  msgget - get a System V message queue identifier
int msgget(key_t key, int msgflg);

//  msgrcv, msgsnd - System V message queue operations
int msgsnd(int msqid, const void *msgp, size_t msgsz, int msgflg);

ssize_t msgrcv(int msqid, void *msgp, size_t msgsz, long msgtyp, int msgflg);

//  msgctl - System V message control operations
int msgctl(int msqid, int cmd, struct msqid_ds *buf);
```

**Semaphore Arrays(信号量数组)**

`semget()`

`semop()`

`semctl()`

```c
#include <sys/types.h>
#include <sys/ipc.h>
#include <sys/sem.h>

//  semget - get a System V semaphore set identifier
int semget(key_t key, int nsems, int semflg);


//  System V semaphore operations
int semop(int semid, struct sembuf *sops, size_t nsops);

//  semctl - System V semaphore control operations
int semctl(int semid, int semnum, int cmd, ...);
```

**Shared Memory Segments(共享内存)**

`shmget()`

`shmop()`

`shmctl()`

```c
#include <sys/ipc.h>
#include <sys/shm.h>

//  shmget - allocates a System V shared memory segment
int shmget(key_t key, size_t size, int shmflg);

//  shmat, shmdt - System V shared memory operations
void *shmat(int shmid, const void *shmaddr, int shmflg);

int shmdt(const void *shmaddr);

//  shmctl - System V shared memory control
int shmctl(int shmid, int cmd, struct shmid_ds *buf);
```

## 网络套接字socket